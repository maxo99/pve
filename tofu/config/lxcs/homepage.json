{
    "container_name": "homepage-dashboard",
    "container_id": 2005,
    "node_name": "pve-01",
    "description": "Container LXC Homepage Dashboard Service",
    "tags": ["dashboard", "web", "homepage", "lxc"],
    "memory": 4096,
    "cores": 2,
    "disk_size": 6,
    "network_bridge": "vmbr0",
    "ip_config": {
      "ipv4_address": "dhcp",
      "gateway": ""
    },
    "datastore_id": "local-lvm",
    "feature_nesting": true,
    "unprivileged": true,
    "start_at_boot": true,
    "packages": [
      "curl",
      "wget",
      "gnupg",
      "ca-certificates",
      "jq",
      "git"
    ],
    "custom_scripts": [
      "# Install Node.js 22 LTS",
      "curl -fsSL https://deb.nodesource.com/setup_22.x | bash -",
      "apt-get install -y nodejs",
      
      "# Install pnpm package manager",
      "npm install -g pnpm@latest",
      
      "# Create homepage directory and user",
      "mkdir -p /opt/homepage",
      "useradd -r -s /bin/false homepage || true",
      
      "# Get latest homepage release",
      "RELEASE=$(curl -fsSL https://api.github.com/repos/gethomepage/homepage/releases/latest | jq -r '.tag_name' | sed 's/^v//')",
      "echo \"Installing Homepage v$RELEASE\"",
      
      "# Download and extract homepage",
      "cd /tmp",
      "curl -fsSL \"https://github.com/gethomepage/homepage/archive/refs/tags/v${RELEASE}.tar.gz\" -o homepage.tar.gz",
      "tar -xzf homepage.tar.gz",
      "cp -r homepage-${RELEASE}/* /opt/homepage/",
      "rm -rf homepage-${RELEASE} homepage.tar.gz",
      
      "# Set permissions",
      "chown -R homepage:homepage /opt/homepage",
      
      "# Install dependencies and build",
      "cd /opt/homepage",
      "sudo -u homepage pnpm install",
      "sudo -u homepage pnpm update --no-save caniuse-lite",
      
      "# Set build environment variables",
      "export NEXT_PUBLIC_VERSION=\"v$RELEASE\"",
      "export NEXT_PUBLIC_REVISION=\"source\"", 
      "export NEXT_PUBLIC_BUILDTIME=$(curl -fsSL https://api.github.com/repos/gethomepage/homepage/releases/latest | jq -r '.published_at')",
      "export NEXT_TELEMETRY_DISABLED=1",
      
      "# Build the application",
      "sudo -u homepage NEXT_PUBLIC_VERSION=\"v$RELEASE\" NEXT_PUBLIC_REVISION=\"source\" NEXT_TELEMETRY_DISABLED=1 pnpm build",
      
      "# Create environment file",
      "LOCAL_IP=$(hostname -I | awk '{print $1}')",
      "echo \"HOMEPAGE_ALLOWED_HOSTS=localhost:3000,${LOCAL_IP}:3000\" > /opt/homepage/.env",
      "chown homepage:homepage /opt/homepage/.env",
      
      "# Create systemd service",
      "cat > /etc/systemd/system/homepage.service << 'EOF'",
      "[Unit]",
      "Description=Homepage Dashboard",
      "After=network.target",
      "",
      "[Service]",
      "Type=exec",
      "User=homepage",
      "Group=homepage",
      "WorkingDirectory=/opt/homepage",
      "ExecStart=/usr/bin/pnpm start",
      "Restart=always",
      "RestartSec=10",
      "Environment=NODE_ENV=production",
      "Environment=NEXT_TELEMETRY_DISABLED=1",
      "",
      "[Install]",
      "WantedBy=multi-user.target",
      "EOF",
      
      "# Store version info",
      "echo \"$RELEASE\" > /opt/homepage_version.txt",
      
      "# Enable and start service",
      "systemctl daemon-reload",
      "systemctl enable homepage",
      "systemctl start homepage",
      
      "# Show final status",
      "echo \"Homepage Dashboard installed successfully!\"",
      "echo \"Access URL: http://$(hostname -I | awk '{print $1}'):3000\"",
      "systemctl status homepage --no-pager"
    ]
  }
