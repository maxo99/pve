{
    "container_name": "cockpit-management",
    "container_id": 2008,
    "node_name": "pve-01",
    "description": "Container LXC Cockpit Management Interface with File Sharing, Identities, and Navigator",
    "tags": ["management", "cockpit", "monitoring", "network", "lxc"],
    "memory": 2048,
    "cores": 2,
    "disk_size": 8,
    "network_bridge": "vmbr0",
    "ip_config": {
      "ipv4_address": "dhcp",
      "gateway": ""
    },
    "datastore_id": "local-lvm",
    "feature_nesting": true,
    "unprivileged": true,
    "start_at_boot": true,
    "generate_admin_password": true,
    "admin_user": "cockpitadmin",
    "vault_kv_path": "lxc/passwords/cockpit",
    "mount_points": [
      {
        "host_path": "/mnt/proxmox-shared",
        "container_path": "/mnt/shared",
        "options": "bind,create=dir"
      },
      {
        "host_path": "/mnt/proxmox-personal", 
        "container_path": "/mnt/personal",
        "options": "bind,create=dir"
      },
      {
        "host_path": "/mnt/proxmox-snapshots",
        "container_path": "/mnt/snapshots", 
        "options": "bind,create=dir,ro"
      },
      {
        "host_path": "/tank",
        "container_path": "/mnt/tank",
        "options": "bind,create=dir"
      }
    ],
    "packages": [
      "cockpit",
      "cockpit-ws",
      "cockpit-system",
      "cockpit-networkmanager",
      "cockpit-storaged",
      "attr",
      "nfs-kernel-server",
      "samba",
      "samba-common-bin",
      "winbind",
      "gawk",
      "psmisc",
      "rsync",
      "zip",
      "curl",
      "wget"
    ],
    "custom_scripts": [
      "# Start and enable Cockpit",
      "systemctl start cockpit",
      "systemctl enable cockpit",
      "echo 'Cockpit started - admin user will be configured via Ansible post-deployment'",
      "",
      "# Install Cockpit File Sharing module",
      "echo 'Installing Cockpit File Sharing module...'",
      "URL=$(curl -fsSL https://api.github.com/repos/45Drives/cockpit-file-sharing/releases/latest | grep download | grep focal_all.deb | cut -d\\\" -f4)",
      "FILE=$(basename \"$URL\")",
      "curl -fsSL \"$URL\" -o \"$FILE\"",
      "dpkg -i \"$FILE\" || apt-get install -f -y",
      "rm -f \"$FILE\"",
      "echo 'Cockpit File Sharing module installed successfully'",
      "",
      "# Install Cockpit Identities module", 
      "echo 'Installing Cockpit Identities module...'",
      "URL=$(curl -fsSL https://api.github.com/repos/45Drives/cockpit-identities/releases/latest | grep download | grep focal_all.deb | cut -d\\\" -f4)",
      "FILE=$(basename \"$URL\")",
      "curl -fsSL \"$URL\" -o \"$FILE\"",
      "dpkg -i \"$FILE\" || apt-get install -f -y",
      "rm -f \"$FILE\"",
      "echo 'Cockpit Identities module installed successfully'",
      "",
      "# Install Cockpit Navigator module",
      "echo 'Installing Cockpit Navigator module...'", 
      "URL=$(curl -fsSL https://api.github.com/repos/45Drives/cockpit-navigator/releases/latest | grep download | grep focal_all.deb | cut -d\\\" -f4)",
      "FILE=$(basename \"$URL\")",
      "curl -fsSL \"$URL\" -o \"$FILE\"",
      "dpkg -i \"$FILE\" || apt-get install -f -y",
      "rm -f \"$FILE\"",
      "echo 'Cockpit Navigator module installed successfully'",
      "",
      "# Configure Cockpit to listen on all interfaces",
      "mkdir -p /etc/cockpit/ws-certs.d",
      "",
      "# Create mount point directories",
      "mkdir -p /mnt/shared /mnt/personal /mnt/snapshots /mnt/tank",
      "echo 'Storage mount points created'",
      "",
      "# Configure storage permissions for cockpit user access",
      "chown -R root:disk /mnt/shared /mnt/personal /mnt/tank || true",
      "chmod -R 755 /mnt/shared /mnt/personal /mnt/tank || true",
      "echo 'Storage permissions configured'",
      "",
      "# Restart Cockpit to apply all changes",
      "systemctl restart cockpit",
      "",
      "# Display final status and access information",
      "LOCAL_IP=$(hostname -I | awk '{print $1}')",
      "echo ''",
      "echo 'Cockpit Management Interface installed successfully!'",
      "echo 'Installed modules:'",
      "echo '  - Core Cockpit (System monitoring, services, logs)'",
      "echo '  - File Sharing (Samba/NFS management)'", 
      "echo '  - Identities (User/Group management)'",
      "echo '  - Navigator (File browser and management)'",
      "echo ''",
      "echo 'Available Storage:'",
      "echo '  - /mnt/shared (BTRFS proxmox-shared)'",
      "echo '  - /mnt/personal (BTRFS proxmox-personal)'", 
      "echo '  - /mnt/snapshots (BTRFS snapshots - read-only)'",
      "echo '  - /mnt/tank (ZFS tank pool)'",
      "echo ''",
      "echo \"Access URL: https://${LOCAL_IP}:9090\"",
      "echo 'Login credentials:'",
      "echo '  Username: cockpitadmin'",
      "echo '  Password: Stored in Vault at lxc/passwords/cockpit'",
      "echo 'Alternative: Use any system user account'",
      "echo ''",
      "systemctl status cockpit --no-pager"
    ]
  }
